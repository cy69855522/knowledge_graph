# 第一章：简介 🚀

## 1.1 异构并行计算 🏗️

### CPU vs GPU 设计哲学 ⚖️

| 特性 | CPU | GPU |
|------|-----|-----|
| **设计目标** | 最小化延迟 | 最大化吞吐量 |
| **核心数量** | 少量强核心 (8-128) | 大量简单核心 (数千) |
| **缓存** | 大缓存，减少内存延迟 | 小缓存，依赖线程切换隐藏延迟 |
| **适合场景** | 顺序代码、分支密集 | 数据并行、计算密集 |

### 性能对比 (A100 vs Intel 24核) ⚡

| 指标 | A100 GPU | Intel CPU |
|------|----------|-----------|
| FP64 | 9.7 TFLOPS | 0.33 TFLOPS |
| FP32 | 156 TFLOPS | 0.66 TFLOPS |
| FP16 | 312 TFLOPS | - |

**结论**：GPU 峰值算力是 CPU 的 **~100-200 倍**，但需要大量并行线程才能发挥。🚀

### 异构计算模型 🔄
```
应用程序 = 顺序部分 (CPU) + 并行部分 (GPU)
```
- **CPU**：处理控制流、I/O、顺序逻辑 🖥️
- **GPU**：处理数据并行的计算密集型任务 🎮

## 1.2 为什么需要更高速度？ 🏎️

### 推动并行计算的应用 🌟
- **深度学习**：训练需要海量计算 🧠
- **科学模拟**：分子动力学、流体力学 🧪
- **图形渲染**：实时光线追踪 🎨
- **视频处理**：编解码、超分辨率 🎬

### 数据并行性 📊
当大量数据可以**独立处理**时，存在数据并行性：
- 图像处理：每个像素独立计算 🖼️
- 矩阵运算：每个元素独立计算 🔢
- 神经网络：批量样本独立前向传播 🌊

## 1.3 加速实际应用 🚀

### Amdahl 定律 📐
$$
\text{加速比} = \frac{1}{(1-P) + \frac{P}{S}}
$$
- $P$：可并行化部分占比
- $S$：并行部分的加速倍数

**示例**：
| 可并行化比例 | 并行加速 100x | 最大加速比 |
|--------------|---------------|------------|
| 30% | 1.43x | 1.43x |
| 90% | 9.2x | 10x |
| 99% | 50x | 100x |

**结论**：要获得高加速比，**99%+ 的代码必须可并行化**。❗

### 实际瓶颈 🐢
- **内存带宽**：直接并行化通常受限于内存带宽，只能达到 ~10x 加速 📉
- **优化后**：通过 Tiling 等技术减少内存访问，可达 **100x+** 加速 📈

## 1.4 并行编程的挑战 🚧

| 挑战 | 说明 | 解决方案 |
|------|------|----------|
| **算法复杂度** | 并行算法可能做更多冗余工作 | 工作效率分析、前缀和等模式 |
| **内存瓶颈** | 数据传输速度限制性能 | Tiling、合并访问、共享内存 |
| **负载不均衡** | 线程工作量不一致 | 动态调度、数据重排 |
| **同步开销** | 线程协作需要同步 | 减少同步、原子操作优化 |

## 1.5 相关并行编程接口 🔌

| 接口 | 特点 | 适用场景 |
|------|------|----------|
| **CUDA** | NVIDIA GPU 专用，显式控制 | GPU 编程学习、高性能计算 |
| **OpenCL** | 跨平台标准 | 多厂商 GPU/加速器 |
| **OpenMP** | 编译器指令，自动并行化 | CPU 多线程、简单 GPU offload |
| **MPI** | 消息传递，分布式内存 | 集群计算、多节点 |

## 1.6 本书目标 🎯

1. **高性能**：掌握 GPU 优化技术 🚀
2. **正确性**：理解同步、内存一致性 ✅
3. **可扩展性**：代码能在未来硬件上更快 📈

## 1.7 书籍结构 📖

### 第一部分：基础概念 (Ch 2-6) ⭐
- Ch2: CUDA 编程基础
- Ch3: 多维网格 and 数据
- Ch4: 计算架构 and 调度
- Ch5: 内存架构 and 数据局部性
- Ch6: 性能考虑

### 第二部分：基本并行模式 (Ch 7-12) 🛠️
- 卷积、Stencil、直方图、规约、前缀和、归并

### 第三部分：高级模式 and 应用 (Ch 13-19) 🚀
- 排序、稀疏矩阵、图遍历、深度学习、MRI 重建等

### 第四部分：高级实践 (Ch 20-22) 🎓
- 异构集群编程、动态并行、高级特性

## 核心要点 💡

1. **GPU 是吞吐量导向**：用大量线程隐藏延迟 🌊
2. **数据并行是关键**：找到可独立处理的数据 🧩
3. **内存是瓶颈**：优化数据访问比优化计算更重要 💾
4. **Amdahl 定律**：并行化比例决定加速上限 📏
