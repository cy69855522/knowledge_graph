# 3.3 Continuous Batching (æŒç»­æ‰¹å¤„ç†) ğŸŒŠ

## ğŸ¯ æ ¸å¿ƒç›®æ ‡
å¦‚ä½•è®© GPU æ°¸è¿œä¸ä¼‘æ¯ï¼Ÿç­”æ¡ˆæ˜¯ **Iteration Level Scheduling**ã€‚

## ğŸ’¡ æ¦‚å¿µè§£æ

### 1. Static Batching (é™æ€æ‰¹å¤„ç†) çš„ç—›ç‚¹ ğŸ›‘
ä¼ ç»Ÿ Batching å¿…é¡»ç­‰ Batch é‡Œ**æ‰€æœ‰**å¥å­éƒ½ç”Ÿæˆå®Œæ‰èƒ½é‡Šæ”¾èµ„æºã€‚
*   ç”¨æˆ·çš„ Prompt é•¿åº¦ä¸ä¸€ã€‚
*   ç”Ÿæˆçš„é•¿åº¦ä¹Ÿä¸ä¸€ã€‚
*   **çŸ­æ¿æ•ˆåº”:** æ•´ä¸ª Batch çš„é€Ÿåº¦å–å†³äºæœ€æ…¢çš„é‚£ä¸ªè¯·æ±‚ã€‚å¦‚æœä¸€ä¸ªå¥å­ç‰¹åˆ«é•¿ï¼Œå…¶ä»–çŸ­å¥å­ç”Ÿæˆå®Œåï¼Œå¯¹åº”çš„æ˜¾å¡ç®—åŠ›å°±é—²ç½®äº† (Bubble)ã€‚

#### ğŸ“¸ CV å·¥ç¨‹å¸ˆç±»æ¯”
*   **Static Batching:** è®­ç»ƒ ResNet æ—¶ï¼Œå¿…é¡»å‡‘é½ 32 å¼ å›¾æ‰èƒ½åšä¸€æ¬¡ Forwardã€‚å¦‚æœæœ‰ä¸€å¼ å›¾è¯»å–æ…¢äº†ï¼Œæ•´ä¸ª GPU éƒ½è¦ç­‰ã€‚ ğŸ¢

### 2. Continuous Batching (aka Dynamic Batching) ğŸš€
ä¸å†ä»¥ "Request Level" ä¸ºå•ä½ï¼Œè€Œæ˜¯ä»¥ "Iteration Level" ä¸ºå•ä½ã€‚
*   **æœºåˆ¶:**
    *   æƒ³è±¡ä½ åŒæ—¶å¤„ç† 10 è·¯ RTSP è§†é¢‘æµã€‚
    *   **ä¸éœ€è¦** ç­‰ 10 è·¯æµçš„ç¬¬ä¸€å¸§éƒ½åˆ°é½å†å¤„ç†ã€‚
    *   **åªè¦æœ‰ä¸€è·¯æµæ¥äº†æ–°å¸§**ï¼Œå°±ç«‹åˆ»å¡è¿› GPU çš„é˜Ÿåˆ—é‡Œå¤„ç† (Iteration Level)ã€‚
    *   æœ‰äººé€€å‡ºäº† (ç”Ÿæˆç»“æŸ)ï¼Œç«‹åˆ»æŠŠæ–°ç”¨æˆ·å¡è¿›è¿™ä¸ª Slotã€‚

**æ ¸å¿ƒé€»è¾‘:** "Run-to-completion" (è·‘å®Œå†èµ°) -> "Iteration-level scheduling" (ä¸€æ¬¡è·‘ä¸€æ­¥ï¼Œéšæ—¶æ¢äºº)ã€‚

## âš”ï¸ è¯¾åå®æˆ˜ (Action Items)
1.  **Benchmarking:**
    æ¯”è¾ƒä¸€ä¸‹ TGI (Text Generation Inference) å’Œ vLLM åœ¨é•¿çŸ­ä¸ä¸€çš„è´Ÿè½½ä¸‹çš„ Throughputã€‚
    *   å¦‚æœ payload é•¿åº¦éƒ½å¾ˆå‡åŒ€ï¼ŒContinuous Batching ä¼˜åŠ¿ä¸æ˜æ˜¾ã€‚
    *   å¦‚æœ payload é•¿åº¦æ–¹å·®å¾ˆå¤§ (æœ‰çš„ç”Ÿæˆ 10 ä¸ªå­—ï¼Œæœ‰çš„ç”Ÿæˆ 1000 ä¸ªå­—)ï¼ŒContinuous Batching èƒ½å¸¦æ¥ **20x** çš„ååæå‡ï¼ğŸ’¥
